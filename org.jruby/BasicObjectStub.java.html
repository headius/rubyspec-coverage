<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BasicObjectStub.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">rubyspec coverage</a> &gt; <a href="index.source.html" class="el_package">org.jruby</a> &gt; <span class="el_source">BasicObjectStub.java</span></div><h1>BasicObjectStub.java</h1><pre class="source lang-java linenums">/***** BEGIN LICENSE BLOCK *****
 * Version: EPL 1.0/GPL 2.0/LGPL 2.1
 *
 * The contents of this file are subject to the Eclipse Public
 * License Version 1.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of
 * the License at http://www.eclipse.org/legal/epl-v10.html
 *
 * Software distributed under the License is distributed on an &quot;AS
 * IS&quot; basis, WITHOUT WARRANTY OF ANY KIND, either express or
 * implied. See the License for the specific language governing
 * rights and limitations under the License.
 *
 * Copyright (C) 2009 Charles O Nutter &lt;headius@headius.com&gt;
 *
 * Alternatively, the contents of this file may be used under the terms of
 * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),
 * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),
 * in which case the provisions of the GPL or the LGPL are applicable instead
 * of those above. If you wish to allow use of your version of this file only
 * under the terms of either the GPL or the LGPL, and not to allow others to
 * use your version of this file under the terms of the EPL, indicate your
 * decision by deleting the provisions above and replace them with the notice
 * and other provisions required by the GPL or the LGPL. If you do not delete
 * the provisions above, a recipient may use your version of this file under
 * the terms of any one of the EPL, the GPL or the LGPL.
 ***** END LICENSE BLOCK *****/
package org.jruby;

import java.util.Collections;
import java.util.List;

import org.jruby.runtime.Helpers;
import org.jruby.runtime.Block;
import org.jruby.runtime.ThreadContext;
import org.jruby.runtime.builtin.IRubyObject;
import org.jruby.runtime.builtin.InstanceVariables;
import org.jruby.runtime.builtin.InternalVariables;
import org.jruby.runtime.builtin.RubyJavaObject;
import org.jruby.runtime.builtin.Variable;

import static org.jruby.runtime.invokedynamic.MethodNames.INSPECT;
import static org.jruby.runtime.Helpers.invokedynamic;
import org.jruby.util.TypeConverter;

<span class="nc" id="L46">public final class BasicObjectStub {</span>
    public static IRubyObject callSuper(IRubyObject self, ThreadContext context, IRubyObject[] args, Block block) {
<span class="nc" id="L48">        return Helpers.invokeSuper(context, self, args, block);</span>
    }

    public static IRubyObject callMethod(IRubyObject self, ThreadContext context, String name) {
<span class="nc" id="L52">        return Helpers.invoke(context, self, name);</span>
    }

    public static IRubyObject callMethod(IRubyObject self, ThreadContext context, String name, IRubyObject arg) {
<span class="nc" id="L56">        return Helpers.invoke(context, self, name, arg);</span>
    }

    public static IRubyObject callMethod(IRubyObject self, ThreadContext context, String name, IRubyObject[] args) {
<span class="nc" id="L60">        return Helpers.invoke(context, self, name, args);</span>
    }

    public static IRubyObject callMethod(IRubyObject self, ThreadContext context, String name, IRubyObject[] args, Block block) {
<span class="nc" id="L64">        return Helpers.invoke(context, self, name, args, block);</span>
    }

    public static IRubyObject callMethod(IRubyObject self, ThreadContext context, int methodIndex, String name) {
<span class="nc" id="L68">        return Helpers.invoke(context, self, name);</span>
    }

    public static IRubyObject callMethod(IRubyObject self, ThreadContext context, int methodIndex, String name, IRubyObject arg) {
<span class="nc" id="L72">        return Helpers.invoke(context, self, name, arg);</span>
    }

    public static boolean isNil(IRubyObject self) {
<span class="nc" id="L76">        return false;</span>
    }

    public static boolean isTrue(IRubyObject self) {
<span class="nc" id="L80">        return true;</span>
    }

    public static boolean isTaint(IRubyObject self) {
<span class="nc" id="L84">        return false;</span>
    }

    public static void setTaint(IRubyObject self, boolean b) {
<span class="nc" id="L88">    }</span>

    public static IRubyObject infectBy(IRubyObject self, IRubyObject obj) {
<span class="nc" id="L91">        return self;</span>
    }

    public static boolean isFrozen(IRubyObject self) {
<span class="nc" id="L95">        return false;</span>
    }

    public static void setFrozen(IRubyObject self, boolean b) {
<span class="nc" id="L99">    }</span>

    public static boolean isUntrusted(IRubyObject self) {
<span class="nc" id="L102">        return false;</span>
    }

    public static void setUntrusted(IRubyObject self, boolean b) {
<span class="nc" id="L106">    }</span>

    public static boolean isImmediate(IRubyObject self) {
<span class="nc" id="L109">        return false;</span>
    }

    public static RubyClass getMetaClass(IRubyObject self) {
<span class="nc bnc" id="L113" title="All 2 branches missed.">        if (self instanceof RubyBasicObject) {</span>
<span class="nc" id="L114">            return ((RubyBasicObject)self).getMetaClass();</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">        } else if (self instanceof RubyJavaObject) {</span>
<span class="nc" id="L116">            return ((RubyJavaObject)self).getMetaClass();</span>
        } else {
<span class="nc" id="L118">            throw new RuntimeException(&quot;unknown object type in BasicObjectStuff.getMetaClass: &quot; + self.getClass());</span>
        }
    }

    public static RubyClass getSingletonClass(IRubyObject self) {
<span class="nc" id="L123">        throw new UnsupportedOperationException(&quot;Not supported yet.&quot;);</span>
    }

    public static RubyClass getType(IRubyObject self) {
<span class="nc" id="L127">        return getMetaClass(self).getRealClass();</span>
    }

    public static boolean respondsTo(IRubyObject self, String name) {
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if(getMetaClass(self).searchMethod(&quot;respond_to?&quot;).equals(getRuntime(self).getRespondToMethod())) {</span>
<span class="nc" id="L132">            return getMetaClass(self).isMethodBound(name, false);</span>
        } else {
<span class="nc" id="L134">            return callMethod(self, getRuntime(self).getCurrentContext(), &quot;respond_to?&quot;, getRuntime(self).newSymbol(name)).isTrue();</span>
        }
    }

    public static Ruby getRuntime(IRubyObject self) {
<span class="nc" id="L139">        return getMetaClass(self).getClassRuntime();</span>
    }

    public static Class getJavaClass(IRubyObject self) {
<span class="nc" id="L143">        return self.getClass();</span>
    }

    public static String asJavaString(IRubyObject self) {
<span class="nc" id="L147">        IRubyObject asString = checkStringType(self);</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">        if(!asString.isNil()) return ((RubyString)asString).asJavaString();</span>
<span class="nc" id="L149">        throw getRuntime(self).newTypeError(inspect(self).toString() + &quot; is not a string&quot;);</span>
    }

    public static RubyString asString(IRubyObject self) {
<span class="nc" id="L153">        IRubyObject str = Helpers.invoke(getRuntime(self).getCurrentContext(), self, &quot;to_s&quot;);</span>

<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (!(str instanceof RubyString)) return (RubyString)anyToString(self);</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">        if (isTaint(self)) str.setTaint(true);</span>
<span class="nc" id="L157">        return (RubyString) str;</span>
    }

    public static RubyArray convertToArray(IRubyObject self) {
<span class="nc" id="L161">        return (RubyArray) TypeConverter.convertToType(self, getRuntime(self).getArray(), &quot;to_ary&quot;);</span>
    }

    public static RubyHash convertToHash(IRubyObject self) {
<span class="nc" id="L165">        return (RubyHash)TypeConverter.convertToType(self, getRuntime(self).getHash(), &quot;to_hash&quot;);</span>
    }

    public static RubyFloat convertToFloat(IRubyObject self) {
<span class="nc" id="L169">        return (RubyFloat) TypeConverter.convertToType(self, getRuntime(self).getFloat(), &quot;to_f&quot;);</span>
    }

    public static RubyInteger convertToInteger(IRubyObject self) {
<span class="nc" id="L173">        return convertToInteger(self, &quot;to_int&quot;);</span>
    }

    public static RubyInteger convertToInteger(IRubyObject self, int convertMethodIndex, String convertMethod) {
<span class="nc" id="L177">        return convertToInteger(self, convertMethod);</span>
    }

    public static RubyInteger convertToInteger(IRubyObject self, String convertMethod) {
<span class="nc" id="L181">        IRubyObject val = TypeConverter.convertToType(self, getRuntime(self).getInteger(), convertMethod, true);</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">        if (!(val instanceof RubyInteger)) throw getRuntime(self).newTypeError(getMetaClass(self).getName() + &quot;#&quot; + convertMethod + &quot; should return Integer&quot;);</span>
<span class="nc" id="L183">        return (RubyInteger)val;</span>
    }

    public static RubyString convertToString(IRubyObject self) {
<span class="nc" id="L187">        return (RubyString) TypeConverter.convertToType(self, getRuntime(self).getString(), &quot;to_str&quot;);</span>
    }

    public static IRubyObject anyToString(IRubyObject self) {
<span class="nc" id="L191">        String cname = getMetaClass(self).getRealClass().getName();</span>
        /* 6:tags 16:addr 1:eos */
<span class="nc" id="L193">        RubyString str = getRuntime(self).newString(&quot;#&lt;&quot; + cname + &quot;:0x&quot; + Integer.toHexString(System.identityHashCode(self)) + &quot;&gt;&quot;);</span>
<span class="nc" id="L194">        str.setTaint(isTaint(self));</span>
<span class="nc" id="L195">        return str;</span>
    }

    public static IRubyObject checkStringType(IRubyObject self) {
<span class="nc" id="L199">        IRubyObject str = TypeConverter.convertToTypeWithCheck(self, getRuntime(self).getString(), &quot;to_str&quot;);</span>
<span class="nc bnc" id="L200" title="All 4 branches missed.">        if(!str.isNil() &amp;&amp; !(str instanceof RubyString)) {</span>
<span class="nc" id="L201">            str = RubyString.newEmptyString(getRuntime(self));</span>
        }
<span class="nc" id="L203">        return str;</span>
    }

    public static IRubyObject checkArrayType(IRubyObject self) {
<span class="nc" id="L207">        return TypeConverter.convertToTypeWithCheck(self, getRuntime(self).getArray(), &quot;to_ary&quot;);</span>
    }

    public static Object toJava(IRubyObject self, Class cls) {
<span class="nc bnc" id="L211" title="All 2 branches missed.">        if (cls.isAssignableFrom(self.getClass())) {</span>
<span class="nc" id="L212">            return self;</span>
        } else {
<span class="nc" id="L214">            throw getRuntime(self).newTypeError(&quot;could not convert &quot; + self.getClass() + &quot; to &quot; + cls);</span>
        }
    }

    public static IRubyObject dup(IRubyObject self) {
        // TODO: java.lang.Object.clone?
<span class="nc" id="L220">        throw new UnsupportedOperationException(&quot;Not supported yet.&quot;);</span>
    }

    public static IRubyObject inspect(IRubyObject self) {
<span class="nc" id="L224">        Ruby runtime = getRuntime(self);</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">        if (hasVariables(self)) {</span>
<span class="nc" id="L226">            StringBuilder part = new StringBuilder();</span>
<span class="nc" id="L227">            String cname = getMetaClass(self).getRealClass().getName();</span>
<span class="nc" id="L228">            part.append(&quot;#&lt;&quot;).append(cname).append(&quot;:0x&quot;);</span>
<span class="nc" id="L229">            part.append(Integer.toHexString(System.identityHashCode(self)));</span>

<span class="nc bnc" id="L231" title="All 2 branches missed.">            if (runtime.isInspecting(self)) {</span>
                /* 6:tags 16:addr 1:eos */
<span class="nc" id="L233">                part.append(&quot; ...&gt;&quot;);</span>
<span class="nc" id="L234">                return runtime.newString(part.toString());</span>
            }
            try {
<span class="nc" id="L237">                runtime.registerInspecting(self);</span>
<span class="nc" id="L238">                return runtime.newString(inspectObj(self, part).toString());</span>
            } finally {
<span class="nc" id="L240">                runtime.unregisterInspecting(self);</span>
            }
        }

<span class="nc" id="L244">        return Helpers.invoke(runtime.getCurrentContext(), self, &quot;to_s&quot;);</span>
    }


    /** inspect_obj
     *
     * The internal helper method that takes care of the part of the
     * inspection that inspects instance variables.
     */
    private static StringBuilder inspectObj(IRubyObject self, StringBuilder part) {
<span class="nc" id="L254">        ThreadContext context = getRuntime(self).getCurrentContext();</span>
<span class="nc" id="L255">        String sep = &quot;&quot;;</span>

<span class="nc bnc" id="L257" title="All 2 branches missed.">        for (Variable&lt;IRubyObject&gt; ivar : getInstanceVariables(self).getInstanceVariableList()) {</span>
<span class="nc" id="L258">            part.append(sep).append(&quot; &quot;).append(ivar.getName()).append(&quot;=&quot;);</span>
<span class="nc" id="L259">            part.append(invokedynamic(context, ivar.getValue(), INSPECT));</span>
<span class="nc" id="L260">            sep = &quot;,&quot;;</span>
<span class="nc" id="L261">        }</span>
<span class="nc" id="L262">        part.append(&quot;&gt;&quot;);</span>
<span class="nc" id="L263">        return part;</span>
    }

    public static IRubyObject rbClone(IRubyObject self) {
        // TODO: java.lang.Object.clone?
<span class="nc" id="L268">        throw new UnsupportedOperationException(&quot;Not supported yet.&quot;);</span>
    }

    public static boolean isModule(IRubyObject self) {
<span class="nc" id="L272">        return false;</span>
    }

    public static boolean isClass(IRubyObject self) {
<span class="nc" id="L276">        return false;</span>
    }

    public static void dataWrapStruct(IRubyObject self, Object obj) {
<span class="nc" id="L280">    }</span>

    public static Object dataGetStruct(IRubyObject self) {
<span class="nc" id="L283">        return null;</span>
    }

    public static Object dataGetStructChecked(IRubyObject self) {
<span class="nc" id="L287">        return null;</span>
    }

    public static IRubyObject id(IRubyObject self) {
<span class="nc" id="L291">        return getRuntime(self).newFixnum(System.identityHashCode(self));</span>
    }

    public static IRubyObject op_equal(IRubyObject self, ThreadContext context, IRubyObject other) {
<span class="nc bnc" id="L295" title="All 2 branches missed.">        return getRuntime(self).newBoolean(self == other);</span>
    }

    public static IRubyObject op_eqq(IRubyObject self, ThreadContext context, IRubyObject other) {
<span class="nc bnc" id="L299" title="All 2 branches missed.">        return getRuntime(self).newBoolean(self == other);</span>
    }

    public static boolean eql(IRubyObject self, IRubyObject other) {
<span class="nc bnc" id="L303" title="All 2 branches missed.">        return self == other;</span>
    }

    public static void addFinalizer(IRubyObject self, IRubyObject finalizer) {
<span class="nc" id="L307">    }</span>

    public static void removeFinalizers(IRubyObject self) {
<span class="nc" id="L310">    }</span>

    public static boolean hasVariables(IRubyObject self) {
<span class="nc" id="L313">        return false;</span>
    }

    public static int getVariableCount(IRubyObject self) {
<span class="nc" id="L317">        return 0;</span>
    }

    public static void syncVariables(IRubyObject self, List&lt;Variable&lt;Object&gt;&gt; variables) {
<span class="nc" id="L321">    }</span>

    public static List&lt;Variable&lt;Object&gt;&gt; getVariableList(IRubyObject self) {
<span class="nc" id="L324">        return Collections.EMPTY_LIST;</span>
    }

    @SuppressWarnings(&quot;deprecation&quot;)
    public static class DummyInstanceVariables implements InstanceVariables {
        private final IRubyObject nil;

<span class="nc" id="L331">        public DummyInstanceVariables(IRubyObject nil) {</span>
<span class="nc" id="L332">            this.nil = nil;</span>
<span class="nc" id="L333">        }</span>

        public boolean hasInstanceVariable(String name) {
<span class="nc" id="L336">            return false;</span>
        }

        public boolean fastHasInstanceVariable(String internedName) {
<span class="nc" id="L340">            return false;</span>
        }

        public IRubyObject getInstanceVariable(String name) {
<span class="nc" id="L344">            return nil;</span>
        }

        public IRubyObject fastGetInstanceVariable(String internedName) {
<span class="nc" id="L348">            return nil;</span>
        }

        public IRubyObject setInstanceVariable(String name, IRubyObject value) {
<span class="nc" id="L352">            return value;</span>
        }

        public IRubyObject fastSetInstanceVariable(String internedName, IRubyObject value) {
<span class="nc" id="L356">            return value;</span>
        }

        public IRubyObject removeInstanceVariable(String name) {
<span class="nc" id="L360">            return nil;</span>
        }

        public List&lt;Variable&lt;IRubyObject&gt;&gt; getInstanceVariableList() {
<span class="nc" id="L364">        return Collections.EMPTY_LIST;</span>
        }

        public List&lt;String&gt; getInstanceVariableNameList() {
<span class="nc" id="L368">        return Collections.EMPTY_LIST;</span>
        }

        public void copyInstanceVariablesInto(InstanceVariables other) {
<span class="nc" id="L372">        }</span>

    }

    public static InstanceVariables getInstanceVariables(IRubyObject self) {
        // TODO: cache in runtime?
<span class="nc" id="L378">        return new DummyInstanceVariables(getRuntime(self).getNil());</span>
    }

<span class="nc" id="L381">    @SuppressWarnings(&quot;deprecation&quot;)</span>
<span class="nc" id="L382">    public static class DummyInternalVariables implements InternalVariables {</span>
        public boolean hasInternalVariable(String name) {
<span class="nc" id="L384">            return false;</span>
        }

        public boolean fastHasInternalVariable(String internedName) {
<span class="nc" id="L388">            return false;</span>
        }

        public Object getInternalVariable(String name) {
<span class="nc" id="L392">            return null;</span>
        }

        public Object fastGetInternalVariable(String internedName) {
<span class="nc" id="L396">            return null;</span>
        }

        public void setInternalVariable(String name, Object value) {
<span class="nc" id="L400">        }</span>

        public void fastSetInternalVariable(String internedName, Object value) {
<span class="nc" id="L403">        }</span>

        public Object removeInternalVariable(String name) {
<span class="nc" id="L406">            return null;</span>
        }
    }
<span class="nc" id="L409">    public static final InternalVariables DUMMY_INTERNAL_VARIABLES = new DummyInternalVariables();</span>

    public static InternalVariables getInternalVariables(IRubyObject self) {
<span class="nc" id="L412">        return DUMMY_INTERNAL_VARIABLES;</span>
    }

    public static List&lt;String&gt; getVariableNameList(IRubyObject self) {
<span class="nc" id="L416">        return Collections.EMPTY_LIST;</span>
    }

    public static void copySpecialInstanceVariables(IRubyObject self, IRubyObject clone) {
<span class="nc" id="L420">    }</span>

    public static Object getVariable(IRubyObject self, int index) {
<span class="nc" id="L423">        return null;</span>
    }

    public static void setVariable(IRubyObject self, int index, Object value) {
<span class="nc" id="L427">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.3.201501050207</span></div></body></html>